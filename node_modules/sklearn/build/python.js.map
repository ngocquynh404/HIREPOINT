{"version":3,"sources":["../src/python.ts"],"sourcesContent":["import assert from 'node:assert'\n\nimport pythonBridge, {\n  type PythonBridge,\n  type PythonBridgeOptions\n} from '@fisch0920/python-bridge'\n\n/**\n * The version of the python `scikit-learn` module this package was built with.\n *\n * Other versions may work, but there may be minor differences in the generated\n * types. We recommend against using other major versions.\n */\nexport const SCIKIT_LEARN_VERSION = '1.5.2'\n\nconst PB = pythonBridge as any\nconst [scikitLearnVersionMajor, scikitLearnVersionMinor] =\n  SCIKIT_LEARN_VERSION.split('.').map((x) => Number.parseInt(x))\n\nexport async function createPythonBridge(\n  opts: PythonBridgeOptions = {}\n): Promise<PythonBridge> {\n  const py = PB({\n    python: 'python3',\n    stdio: ['pipe', 'pipe', 'pipe'],\n    ...opts\n  })\n  await validatePythonBridge(py)\n  return py\n}\n\n// TODO: validate `numpy and `sklearn`\nexport async function validatePythonBridge(py: PythonBridge): Promise<void> {\n  assert(\n    scikitLearnVersionMajor,\n    `invalid scikit-learn version: ${SCIKIT_LEARN_VERSION}`\n  )\n  assert(\n    scikitLearnVersionMinor !== undefined,\n    `invalid scikit-learn version: ${SCIKIT_LEARN_VERSION}`\n  )\n\n  await py.ex`\nfrom platform import python_version\n`\n\n  const pyVersion: string = await py`python_version()`\n  const [pyMajor, pyMinor] = pyVersion.split('.').map((x) => Number.parseInt(x))\n\n  assert(pyMajor, `Invalid python version: \"${pyVersion}\"`)\n  assert(pyMinor !== undefined, `Invalid python version: \"${pyVersion}\"`)\n\n  if (pyMajor < 3) {\n    throw new Error(\n      `Unsupported python version \"${pyVersion}\"; please upgrade to python 3.7 or newer`\n    )\n  }\n\n  if (pyMajor === 3) {\n    if (pyMinor < 7) {\n      throw new Error(\n        `Unsupported python version \"${pyVersion}\"; please upgrade to python 3.7 or newer`\n      )\n    }\n  }\n\n  await py.ex`\nfrom sklearn import __version__\n`\n\n  const sklearnVersion: string = await py`__version__`\n  const [sklearnMajor, sklearnMinor] = sklearnVersion\n    .split('.')\n    .map((x) => Number.parseInt(x))\n\n  assert(sklearnMajor, `Invalid scikit-learn version: \"${sklearnVersion}\"`)\n  assert(\n    sklearnMinor !== undefined,\n    `Invalid scikit-learn version: \"${sklearnVersion}\"`\n  )\n\n  if (sklearnMajor < scikitLearnVersionMajor) {\n    throw new Error(\n      `Unsupported python scikit-learn module version \"${sklearnVersion}\"; please upgrade`\n    )\n  }\n\n  if (sklearnMajor === scikitLearnVersionMajor) {\n    if (sklearnMinor < scikitLearnVersionMinor) {\n      throw new Error(\n        `Unsupported python scikit-learn module version \"${sklearnVersion}\"; please upgrade`\n      )\n    } else if (sklearnMinor > scikitLearnVersionMinor) {\n      console.warn(\n        `Warning: python scikit-learn module version \"${sklearnVersion}\" is MINOR upgrade from ${SCIKIT_LEARN_VERSION} and is untested with the current version of this library`\n      )\n    }\n  } else if (sklearnMajor > scikitLearnVersionMajor) {\n    console.warn(\n      `Warning: python scikit-learn module version \"${sklearnVersion}\" is a MAJOR upgrade from \"${SCIKIT_LEARN_VERSION}\" and is untested with the current version of this library`\n    )\n  }\n}\n\nexport { type PythonBridge } from '@fisch0920/python-bridge'\n"],"mappings":";AAAA,OAAO,YAAY;AAEnB,OAAO,kBAGA;AAQA,IAAM,uBAAuB;AAEpC,IAAM,KAAK;AACX,IAAM,CAAC,yBAAyB,uBAAuB,IACrD,qBAAqB,MAAM,GAAG,EAAE,IAAI,CAAC,MAAM,OAAO,SAAS,CAAC,CAAC;AAE/D,eAAsB,mBACpB,OAA4B,CAAC,GACN;AACvB,QAAM,KAAK,GAAG;AAAA,IACZ,QAAQ;AAAA,IACR,OAAO,CAAC,QAAQ,QAAQ,MAAM;AAAA,IAC9B,GAAG;AAAA,EACL,CAAC;AACD,QAAM,qBAAqB,EAAE;AAC7B,SAAO;AACT;AAGA,eAAsB,qBAAqB,IAAiC;AAC1E;AAAA,IACE;AAAA,IACA,iCAAiC,oBAAoB;AAAA,EACvD;AACA;AAAA,IACE,4BAA4B;AAAA,IAC5B,iCAAiC,oBAAoB;AAAA,EACvD;AAEA,QAAM,GAAG;AAAA;AAAA;AAIT,QAAM,YAAoB,MAAM;AAChC,QAAM,CAAC,SAAS,OAAO,IAAI,UAAU,MAAM,GAAG,EAAE,IAAI,CAAC,MAAM,OAAO,SAAS,CAAC,CAAC;AAE7E,SAAO,SAAS,4BAA4B,SAAS,GAAG;AACxD,SAAO,YAAY,QAAW,4BAA4B,SAAS,GAAG;AAEtE,MAAI,UAAU,GAAG;AACf,UAAM,IAAI;AAAA,MACR,+BAA+B,SAAS;AAAA,IAC1C;AAAA,EACF;AAEA,MAAI,YAAY,GAAG;AACjB,QAAI,UAAU,GAAG;AACf,YAAM,IAAI;AAAA,QACR,+BAA+B,SAAS;AAAA,MAC1C;AAAA,IACF;AAAA,EACF;AAEA,QAAM,GAAG;AAAA;AAAA;AAIT,QAAM,iBAAyB,MAAM;AACrC,QAAM,CAAC,cAAc,YAAY,IAAI,eAClC,MAAM,GAAG,EACT,IAAI,CAAC,MAAM,OAAO,SAAS,CAAC,CAAC;AAEhC,SAAO,cAAc,kCAAkC,cAAc,GAAG;AACxE;AAAA,IACE,iBAAiB;AAAA,IACjB,kCAAkC,cAAc;AAAA,EAClD;AAEA,MAAI,eAAe,yBAAyB;AAC1C,UAAM,IAAI;AAAA,MACR,mDAAmD,cAAc;AAAA,IACnE;AAAA,EACF;AAEA,MAAI,iBAAiB,yBAAyB;AAC5C,QAAI,eAAe,yBAAyB;AAC1C,YAAM,IAAI;AAAA,QACR,mDAAmD,cAAc;AAAA,MACnE;AAAA,IACF,WAAW,eAAe,yBAAyB;AACjD,cAAQ;AAAA,QACN,gDAAgD,cAAc,2BAA2B,oBAAoB;AAAA,MAC/G;AAAA,IACF;AAAA,EACF,WAAW,eAAe,yBAAyB;AACjD,YAAQ;AAAA,MACN,gDAAgD,cAAc,8BAA8B,oBAAoB;AAAA,IAClH;AAAA,EACF;AACF;","names":[]}